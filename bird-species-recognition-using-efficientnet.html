
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EFFICIENT NET &#8212; Proyecto Final Deep Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'bird-species-recognition-using-efficientnet';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="WEB SCAPPING" href="bird_image_web_scraper.html" />
    <link rel="prev" title="Welcome to the final proyect for the class of Deep Learning." href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Proyecto Final Deep Learning - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Proyecto Final Deep Learning - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to the final proyect for the class of Deep Learning.
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">EFFICIENT NET</a></li>









<li class="toctree-l1"><a class="reference internal" href="bird_image_web_scraper.html">WEB SCAPPING</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pre-processing.html">Birds species detection using TensorFlow Object Detection API</a></li>


<li class="toctree-l1"><a class="reference internal" href="Training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tensorboard.html">Tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inference.html">Inference</a></li>


<li class="toctree-l1"><a class="reference internal" href="uninorte-flower-detection-pytorch.html">Pytorch Models</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fbird-species-recognition-using-efficientnet.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/bird-species-recognition-using-efficientnet.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>EFFICIENT NET</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EFFICIENT NET</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-necessary-libraries">Importing necessary libraries</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-paths-to-be-used">Saving paths to be used</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visulalize-the-images">visulalize the images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-distribution-of-images-in-each-class">Checking distribution of images in each class</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#categorizing-the-images">Categorizing the images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-model">Creating our model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-model">Training the Model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-performance-of-model">Evaluate Performance of model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-model-in-real-world-situation">Testing model in real-world situation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-1">Sample 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-2">Sample 2</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="efficient-net">
<h1>EFFICIENT NET<a class="headerlink" href="#efficient-net" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span><span class="o">==</span><span class="mf">2.9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>^C
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting tensorflow==2.9
  Downloading tensorflow-2.9.0-cp310-cp310-win_amd64.whl.metadata (3.0 kB)
Requirement already satisfied: absl-py&gt;=1.0.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.4.0)
Requirement already satisfied: astunparse&gt;=1.6.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.6.3)
Collecting flatbuffers&lt;2,&gt;=1.12 (from tensorflow==2.9)
  Downloading flatbuffers-1.12-py2.py3-none-any.whl.metadata (872 bytes)
Requirement already satisfied: gast&lt;=0.4.0,&gt;=0.2.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (0.4.0)
Requirement already satisfied: google-pasta&gt;=0.1.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (0.2.0)
Requirement already satisfied: h5py&gt;=2.9.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (3.8.0)
Requirement already satisfied: keras-preprocessing&gt;=1.1.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.1.2)
Requirement already satisfied: libclang&gt;=13.0.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (16.0.0)
Requirement already satisfied: numpy&gt;=1.20 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.23.4)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (3.3.0)
Requirement already satisfied: packaging in c:\users\pc\appdata\roaming\python\python310\site-packages (from tensorflow==2.9) (21.3)
Requirement already satisfied: protobuf&gt;=3.9.2 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (3.20.3)
Requirement already satisfied: setuptools in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (68.2.2)
Requirement already satisfied: six&gt;=1.12.0 in c:\users\pc\appdata\roaming\python\python310\site-packages (from tensorflow==2.9) (1.16.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (2.2.0)
Requirement already satisfied: typing-extensions&gt;=3.6.6 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (4.12.2)
Requirement already satisfied: wrapt&gt;=1.11.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.14.1)
Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (0.31.0)
Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorflow==2.9) (1.53.0)
Collecting tensorboard&lt;2.10,&gt;=2.9 (from tensorflow==2.9)
  Downloading tensorboard-2.9.1-py3-none-any.whl.metadata (1.9 kB)
Collecting tensorflow-estimator&lt;2.10.0,&gt;=2.9.0rc0 (from tensorflow==2.9)
  Downloading tensorflow_estimator-2.9.0-py2.py3-none-any.whl.metadata (1.3 kB)
Collecting keras&lt;2.10.0,&gt;=2.9.0rc0 (from tensorflow==2.9)
  Downloading keras-2.9.0-py2.py3-none-any.whl.metadata (1.3 kB)
Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from astunparse&gt;=1.6.0-&gt;tensorflow==2.9) (0.40.0)
Requirement already satisfied: google-auth&lt;3,&gt;=1.6.3 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2.17.2)
Collecting google-auth-oauthlib&lt;0.5,&gt;=0.4.1 (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9)
  Downloading google_auth_oauthlib-0.4.6-py2.py3-none-any.whl.metadata (2.7 kB)
Requirement already satisfied: markdown&gt;=2.6.8 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (3.4.3)
Collecting protobuf&gt;=3.9.2 (from tensorflow==2.9)
  Downloading protobuf-3.19.6-cp310-cp310-win_amd64.whl.metadata (806 bytes)
Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2.31.0)
Collecting tensorboard-data-server&lt;0.7.0,&gt;=0.6.0 (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9)
  Downloading tensorboard_data_server-0.6.1-py3-none-any.whl.metadata (1.1 kB)
Requirement already satisfied: tensorboard-plugin-wit&gt;=1.6.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (1.8.1)
Requirement already satisfied: werkzeug&gt;=1.0.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2.2.3)
Requirement already satisfied: pyparsing!=3.0.5,&gt;=2.0.2 in c:\users\pc\appdata\roaming\python\python310\site-packages (from packaging-&gt;tensorflow==2.9) (3.0.9)
Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (5.3.0)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (0.2.8)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (4.9)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (1.3.1)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2.1.1)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (3.4)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (1.26.13)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2024.2.2)
Requirement already satisfied: MarkupSafe&gt;=2.1.1 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from werkzeug&gt;=1.0.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (2.1.1)
Requirement already satisfied: pyasn1&lt;0.5.0,&gt;=0.4.6 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (0.4.8)
Requirement already satisfied: oauthlib&gt;=3.0.0 in c:\users\pc\appdata\local\programs\python\python310\lib\site-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9) (3.2.2)
Downloading tensorflow-2.9.0-cp310-cp310-win_amd64.whl (444.1 MB)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="importing-necessary-libraries">
<h1>Importing necessary libraries<a class="headerlink" href="#importing-necessary-libraries" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mimg</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span><span class="n">BatchNormalization</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications.efficientnet</span> <span class="kn">import</span> <span class="n">preprocess_input</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">load_img</span><span class="p">,</span> <span class="n">img_to_array</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications.efficientnet</span> <span class="kn">import</span> <span class="n">EfficientNetB0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="saving-paths-to-be-used">
<h1>Saving paths to be used<a class="headerlink" href="#saving-paths-to-be-used" title="Link to this heading">#</a></h1>
<p>First we will save the file-paths which we will be using in this notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">main_path</span> <span class="o">=</span> <span class="s1">&#39;/kaggle/input/10000-bird-species&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_path</span><span class="p">,</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_path</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_path</span><span class="p">,</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visulalize-the-images">
<h1>visulalize the images<a class="headerlink" href="#visulalize-the-images" title="Link to this heading">#</a></h1>
<p>Now we will visualize a image at random with its label name to identify how our image looks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if running this code section mutiple times below code will clear the previous output</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

<span class="c1"># setting size of image plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># choosing a image at random</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">img_choice</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">species</span><span class="p">)))</span>
<span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">species</span><span class="p">,</span><span class="n">img_choice</span><span class="p">)</span>

<span class="c1"># reading and printing the image</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">mimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f8b3b8a3690&gt;
</pre></div>
</div>
<img alt="_images/087aa37007fb0c202038f3f004db3d4d703108d4d12acf06a14f8f14568070f4.png" src="_images/087aa37007fb0c202038f3f004db3d4d703108d4d12acf06a14f8f14568070f4.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="checking-distribution-of-images-in-each-class">
<h1>Checking distribution of images in each class<a class="headerlink" href="#checking-distribution-of-images-in-each-class" title="Link to this heading">#</a></h1>
<p>Now we will check the distributuon of images across different classes, it is necessary because if images are not distributed evenly across the classes, there might be chances that our model can underfit or overfit on the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_species_count</span> <span class="o">=</span><span class="p">{}</span>
<span class="n">list_species</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_path</span><span class="p">,</span><span class="n">train</span><span class="p">))</span>

<span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">list_species</span><span class="p">:</span>
    <span class="n">count_imgs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_path</span><span class="p">,</span><span class="n">train</span><span class="p">,</span><span class="n">each</span><span class="p">)))</span>
    <span class="n">store_species_count</span><span class="p">[</span><span class="n">each</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_imgs</span>

<span class="c1"># Find the minimum value and its key</span>
<span class="n">min_key</span><span class="p">,</span> <span class="n">min_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">store_species_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Find the maximum value and its key</span>
<span class="n">max_key</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">store_species_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Get a list of the dictionary values</span>
<span class="n">values_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">store_species_count</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># Compute the median value</span>
<span class="n">median_value</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">values_list</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum count of images in a class:&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="s2">&quot;corresponding Species:&quot;</span><span class="p">,</span> <span class="n">min_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum count of images in a class:&quot;</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="s2">&quot;corresponding Species:&quot;</span><span class="p">,</span> <span class="n">max_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median value:&quot;</span><span class="p">,</span> <span class="n">median_value</span><span class="p">,</span> <span class="s2">&quot;images&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Minimum count of images in a class: 130 corresponding Species: AMETHYST WOODSTAR
Maximum count of images in a class: 263 corresponding Species: RUFOUS TREPE
Median value: 158 images
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="categorizing-the-images">
<h1>Categorizing the images<a class="headerlink" href="#categorizing-the-images" title="Link to this heading">#</a></h1>
<p>Here we are using Tensorflows ImageDataGenerator function this function takes image directory path. preprocess the image and stratify the count of images in each class such that each class has same number of images for model training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># preprocessing the image and storing it under appropriate labels</span>

<span class="n">train_gen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">width_shift_range</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">height_shift_range</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">train_set</span> <span class="o">=</span> <span class="n">train_gen</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">),</span><span class="n">class_mode</span> <span class="o">=</span> <span class="s1">&#39;categorical&#39;</span><span class="p">,</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 84635 images belonging to 525 classes.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># geting the labels from training data, it will be later used to predict the class when an image is passed</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_set</span><span class="o">.</span><span class="n">class_indices</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>525
</pre></div>
</div>
</div>
</div>
<p>Below we see that we are not preprocessing test and validation data, its because we will be using this images to see how well our model predicts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting data for testing</span>
<span class="n">test_gen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">()</span>

<span class="n">test_set</span> <span class="o">=</span> <span class="n">test_gen</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">),</span><span class="n">class_mode</span> <span class="o">=</span> <span class="s1">&#39;categorical&#39;</span><span class="p">,</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 2625 images belonging to 525 classes.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># getting data for validation</span>
<span class="n">valid_gen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">()</span>

<span class="n">valid_set</span> <span class="o">=</span> <span class="n">valid_gen</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span><span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">),</span><span class="n">class_mode</span> <span class="o">=</span> <span class="s1">&#39;categorical&#39;</span><span class="p">,</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 2625 images belonging to 525 classes.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="creating-our-model">
<h1>Creating our model<a class="headerlink" href="#creating-our-model" title="Link to this heading">#</a></h1>
<p>Now we are ready with our data lets start building our image classifier model, for that first we need to get EfficientNetB0 model from Tensorfow Keras API, more about EfficientNetB0 can be found here <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/applications/efficientnet/EfficientNetB0">https://www.tensorflow.org/api_docs/python/tf/keras/applications/efficientnet/EfficientNetB0</a></p>
<p>Below we can also see that we are setting the layers of our EfficientNetB0 to <strong>False</strong>, its because this model has already been trained on larger set of image data and we are using it classify our birds species, also if we want we can set layers to true, but it will consume more time in training our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eff_net_model</span> <span class="o">=</span> <span class="n">EfficientNetB0</span><span class="p">(</span>
                    <span class="n">include_top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">,</span>
                    <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                    <span class="n">pooling</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span>
                    <span class="n">classes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
                <span class="p">)</span>

<span class="c1"># setting all the layers of this model to false</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">eff_net_model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">trainable</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<p>After we download EfficientNetB0, We are adding custom dense layers to the model so that our model can classify images based on 525 diffent labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eff_net_model</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">2560</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">BatchNormalization</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1280</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential_1&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 efficientnetb0 (Functional)  (None, 1280)             4049571   
                                                                 
 dense_3 (Dense)             (None, 2560)              3279360   
                                                                 
 batch_normalization_1 (Batc  (None, 2560)             10240     
 hNormalization)                                                 
                                                                 
 dense_4 (Dense)             (None, 1280)              3278080   
                                                                 
 dense_5 (Dense)             (None, 525)               672525    
                                                                 
=================================================================
Total params: 11,289,776
Trainable params: 7,235,085
Non-trainable params: 4,054,691
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<p>Now we will its time to select our optimizer for our model, Adam Optimizer is the best optimizer for our use case as it has better optimization and faster compuation time, we can also set learnign rate for our optimizer, I have used 0.00001 as my learning_rate value, this is the best learning rate value for our use-case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">)</span> <span class="p">,</span><span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span><span class="n">metrics</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Using tensorflow&#39;s EarlyStopping , this is used to stop training of model if there is no improvment of loss over each epoch</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Using tensorflow&#39;s Model-Checkpoint to save best model having lower validation loss</span>
<span class="n">modelcheck_lr</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;/kaggle/working/final_model.h5&#39;</span><span class="p">,</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span><span class="n">save_best_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">save_format</span><span class="o">=</span><span class="s1">&#39;tf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="training-the-model">
<h1>Training the Model<a class="headerlink" href="#training-the-model" title="Link to this heading">#</a></h1>
<p>Now we have built our model and specified required optimizer and callbacks, its time to train our model and visualize the training results</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_hist</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span><span class="n">validation_data</span> <span class="o">=</span> <span class="n">valid_set</span><span class="p">,</span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">modelcheck_lr</span><span class="p">,</span><span class="n">early</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
2645/2645 [==============================] - 1959s 738ms/step - loss: 4.7117 - accuracy: 0.1947 - val_loss: 2.4047 - val_accuracy: 0.6400
Epoch 2/20
2645/2645 [==============================] - 1305s 493ms/step - loss: 2.5125 - accuracy: 0.5238 - val_loss: 1.0230 - val_accuracy: 0.8373
Epoch 3/20
2645/2645 [==============================] - 1254s 474ms/step - loss: 1.7741 - accuracy: 0.6339 - val_loss: 0.6282 - val_accuracy: 0.8872
Epoch 4/20
2645/2645 [==============================] - 1247s 471ms/step - loss: 1.4533 - accuracy: 0.6834 - val_loss: 0.4676 - val_accuracy: 0.9078
Epoch 5/20
2645/2645 [==============================] - 1242s 470ms/step - loss: 1.2651 - accuracy: 0.7156 - val_loss: 0.3771 - val_accuracy: 0.9257
Epoch 6/20
2645/2645 [==============================] - 1261s 477ms/step - loss: 1.1446 - accuracy: 0.7389 - val_loss: 0.3263 - val_accuracy: 0.9276
Epoch 7/20
2645/2645 [==============================] - 1251s 473ms/step - loss: 1.0576 - accuracy: 0.7541 - val_loss: 0.2874 - val_accuracy: 0.9371
Epoch 8/20
2645/2645 [==============================] - 1319s 499ms/step - loss: 0.9840 - accuracy: 0.7697 - val_loss: 0.2641 - val_accuracy: 0.9383
Epoch 9/20
2645/2645 [==============================] - 1359s 514ms/step - loss: 0.9322 - accuracy: 0.7780 - val_loss: 0.2421 - val_accuracy: 0.9394
Epoch 10/20
2645/2645 [==============================] - 1295s 490ms/step - loss: 0.8875 - accuracy: 0.7878 - val_loss: 0.2269 - val_accuracy: 0.9448
Epoch 11/20
2645/2645 [==============================] - 1303s 493ms/step - loss: 0.8354 - accuracy: 0.7992 - val_loss: 0.2124 - val_accuracy: 0.9493
Epoch 12/20
2645/2645 [==============================] - 1283s 485ms/step - loss: 0.8074 - accuracy: 0.8055 - val_loss: 0.2086 - val_accuracy: 0.9470
Epoch 13/20
2645/2645 [==============================] - 1230s 465ms/step - loss: 0.7749 - accuracy: 0.8123 - val_loss: 0.1977 - val_accuracy: 0.9516
Epoch 14/20
2645/2645 [==============================] - 1250s 473ms/step - loss: 0.7507 - accuracy: 0.8169 - val_loss: 0.1892 - val_accuracy: 0.9509
Epoch 15/20
2645/2645 [==============================] - 1246s 471ms/step - loss: 0.7250 - accuracy: 0.8216 - val_loss: 0.1787 - val_accuracy: 0.9539
Epoch 16/20
2645/2645 [==============================] - 1237s 468ms/step - loss: 0.7122 - accuracy: 0.8249 - val_loss: 0.1713 - val_accuracy: 0.9547
Epoch 17/20
2645/2645 [==============================] - 1238s 468ms/step - loss: 0.6894 - accuracy: 0.8297 - val_loss: 0.1714 - val_accuracy: 0.9562
Epoch 18/20
2645/2645 [==============================] - 1232s 466ms/step - loss: 0.6697 - accuracy: 0.8341 - val_loss: 0.1669 - val_accuracy: 0.9566
Epoch 19/20
2645/2645 [==============================] - 1244s 470ms/step - loss: 0.6557 - accuracy: 0.8362 - val_loss: 0.1630 - val_accuracy: 0.9558
Epoch 20/20
2645/2645 [==============================] - 1267s 479ms/step - loss: 0.6308 - accuracy: 0.8430 - val_loss: 0.1568 - val_accuracy: 0.9592
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1">#Visualizing the result </span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">val_acc</span> <span class="o">=</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">]</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span>
<span class="n">val_loss</span> <span class="o">=</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="s1">&#39;*-&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Training accuracy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_acc</span><span class="p">,</span> <span class="s1">&#39;*-&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Validation accuracy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Epochs &amp; Training Accuracy&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="s1">&#39;*-&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Training loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="s1">&#39;*-&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Validation loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Epochs &amp; loss&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1fc13307905ee419b1a66492472be4f10deaa1ccb0fda4d4c3d463110ff7153d.png" src="_images/1fc13307905ee419b1a66492472be4f10deaa1ccb0fda4d4c3d463110ff7153d.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="evaluate-performance-of-model">
<h1>Evaluate Performance of model<a class="headerlink" href="#evaluate-performance-of-model" title="Link to this heading">#</a></h1>
<p>Now we have trained the model lets evaluate performance of our model on image data it has not viewed before</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and evaluate best model</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="s1">&#39;/kaggle/working/final_model.h5&#39;</span><span class="p">)</span>
<span class="n">eval_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation Loss :&quot;</span><span class="p">,</span><span class="n">eval_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation Accuracy :&quot;</span><span class="p">,</span><span class="n">eval_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>83/83 [==============================] - 31s 380ms/step - loss: 0.1044 - accuracy: 0.9764
Validation Loss : 0.1043987050652504
Validation Accuracy : 0.9763809442520142
</pre></div>
</div>
</div>
</div>
<p>Now we have seen accuracy and loss of our model using validation set, lets see visually how our model, by picking images at random from validation set.
Below I have created a funtion called “predict_pipeline”, this will take image path (already stored in local) from user and predict the output label of the image accordingly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_pipeline</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
    <span class="c1"># Define the input image size</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
            
    <span class="c1"># load image data</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">load_img</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>
            
    <span class="c1"># convert image to array</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">img_to_array</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            
    <span class="c1"># preprocess the image using efficientnet preprocessor</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Make the prediction</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">]))</span>

    <span class="c1"># get the index of the predicted class</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
    
    <span class="c1"># get the predicted class name</span>
    <span class="n">predicted_class</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># Return prediced_class</span>
    <span class="k">return</span> <span class="n">predicted_class</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># Here we are using gcf to clen the plot if the cell is being runned 2 or more times</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

<span class="c1"># Create a figure and subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">n_cols</span><span class="p">)</span>

<span class="c1"># set size of each image</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">img_path</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># choosing a image at random</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="o">*</span><span class="n">n_cols</span><span class="p">):</span>
    <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">valid</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">bird</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
    <span class="n">img_choice</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">bird</span><span class="p">)))</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">bird</span><span class="p">,</span><span class="n">img_choice</span><span class="p">)</span>
    <span class="n">img_path</span><span class="p">[</span><span class="n">bird</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_path</span>

<span class="c1"># reading and printing the image</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">img_path</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">mimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">predict_pipeline</span><span class="p">(</span><span class="n">img_path</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Actual: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;Predicted: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">predicted</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 1s 1s/step
1/1 [==============================] - 0s 32ms/step
1/1 [==============================] - 0s 30ms/step
1/1 [==============================] - 0s 29ms/step
1/1 [==============================] - 0s 28ms/step
1/1 [==============================] - 0s 27ms/step
1/1 [==============================] - 0s 29ms/step
1/1 [==============================] - 0s 30ms/step
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/ba0d76639571ce74f74d8debc0225953952f2191c1c832214729a5bbc23ce446.png" src="_images/ba0d76639571ce74f74d8debc0225953952f2191c1c832214729a5bbc23ce446.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="testing-model-in-real-world-situation">
<h1>Testing model in real-world situation<a class="headerlink" href="#testing-model-in-real-world-situation" title="Link to this heading">#</a></h1>
<p>Now we are ready with our model, now lets test a situation where user sends url of the image and our model predicts the species of the bird.</p>
<p>Below I defined 2 funtions</p>
<ol class="arabic simple">
<li><p>predict_pipeline_url : This will take URL from user and predict the species of the bird</p></li>
<li><p>predict_bird_from_URL: This will take URL from user print the image and also its label using the “predict_pipeline_url” funtion</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_pipeline_url</span><span class="p">(</span><span class="n">image_url</span><span class="p">):</span>
    <span class="c1"># get the image from the url</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>

    <span class="c1"># Define the input image size</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
            
    <span class="c1"># load image data</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">load_img</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="n">target_size</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)</span>
            
    <span class="c1"># convert image to array</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">img_to_array</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            
    <span class="c1"># preprocess the image using efficientnet preprocessor</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Make the prediction</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">]))</span>

    <span class="c1"># get the index of the predicted class</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
 
    <span class="c1"># get the predicted class name</span>
    <span class="n">predicted_class</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">predicted_class</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_bird_from_URL</span><span class="p">(</span><span class="n">image_url</span><span class="p">):</span>
    <span class="c1"># Here we are using gcf to clean the plot if the cell is being runned 2 or more times</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># get and store the response from URL</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
    
    <span class="c1"># read the image</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">mimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
    
    <span class="c1"># predict the image from URL</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">predict_pipeline_url</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
    
    <span class="c1"># pint the image along with predicted label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicted: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">predicted</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="sample-1">
<h2>Sample 1<a class="headerlink" href="#sample-1" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predict_bird_from_URL</span><span class="p">(</span><span class="s1">&#39;https://cdn.download.ams.birds.cornell.edu/api/v1/asset/78541101/1200&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 0s 29ms/step
</pre></div>
</div>
<img alt="_images/4dc2de8ab91f8010f5a3a3359e7e182cfc4166ce009269fa13c4ffe6b7a79567.png" src="_images/4dc2de8ab91f8010f5a3a3359e7e182cfc4166ce009269fa13c4ffe6b7a79567.png" />
</div>
</div>
</section>
<section id="sample-2">
<h2>Sample 2<a class="headerlink" href="#sample-2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predict_bird_from_URL</span><span class="p">(</span><span class="s1">&#39;https://cdn.britannica.com/22/137322-050-EC0B557E/Gyrfalcon.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 0s 30ms/step
</pre></div>
</div>
<img alt="_images/0aefde2197d73b60347971d1bb467e85b40a5258516cd960efa328f58755c0e1.png" src="_images/0aefde2197d73b60347971d1bb467e85b40a5258516cd960efa328f58755c0e1.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welcome to the final proyect for the class of Deep Learning.</p>
      </div>
    </a>
    <a class="right-next"
       href="bird_image_web_scraper.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">WEB SCAPPING</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EFFICIENT NET</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-necessary-libraries">Importing necessary libraries</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-paths-to-be-used">Saving paths to be used</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visulalize-the-images">visulalize the images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-distribution-of-images-in-each-class">Checking distribution of images in each class</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#categorizing-the-images">Categorizing the images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-our-model">Creating our model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-model">Training the Model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-performance-of-model">Evaluate Performance of model</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-model-in-real-world-situation">Testing model in real-world situation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-1">Sample 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-2">Sample 2</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Juan Esteban Albis
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>